---
layout: note
title: "2025年8月腾文工作记录"
---

## 目录
<details open>
<summary>展开/收起</summary>

* 目录
{:toc}

</details>

## 2025-08-07（周四）
- 壳场细胞和血细胞分群

```R
library(Seurat)
library(stringr)
library(patchwork)
library(tidyverse)
library(monocle)

load(file="../seob.rdata")

seob <- FindNeighbors(seob, k.param = 20, dims = 1:50)
# Find clusters with different resolutions
seob <- FindClusters(seob, resolution = 0.1, random.seed = 1)
DefaultAssay(seob) <- "RNA"
seob_obj <- subset(seob, idents = c(0,2,4,8,12,14))

subset_obj <- SCTransform(seob_obj, verbose = FALSE)
subset_obj <- RunPCA(subset_obj)
subset_obj <- RunUMAP(subset_obj, dims = 1:30)
subset_obj <- FindNeighbors(subset_obj, dims = 1:30)
subset_obj <- FindClusters(subset_obj, resolution = 0.1)

pdf("subset_obj.pca_tsne_umap.pdf",height=4,width=10)
p1 <- DimPlot(subset_obj, reduction = "pca")
p2 <- DimPlot(subset_obj, reduction = "tsne")
p3 <- DimPlot(subset_obj, reduction = "umap")
p1 + p2 + p3 + plot_layout(guides = "collect") & theme(legend.position = "top")
dev.off()
```
<img width="600" height="240" alt="subset_obj pca_tsne_umap" src="https://github.com/user-attachments/assets/49e364f9-0cf5-413c-91ed-909862e5d945" />

```R
pdf("subset_obj.umap.pdf", height=8, width=8)
DimPlot(subset_obj, reduction = "umap")
dev.off()
```
<img width="400" height="400" alt="subset_obj umap" src="https://github.com/user-attachments/assets/05980aa0-a753-4310-a76c-11d67761af76" />

```R
subset_obj$sample <- factor(subset_obj$sample, levels = c("S74OA", "S74WT", "S81OA", "S81WT", "S74OAOA", "S74OAWT", "S74WTOA", "S74WTWT", "S81OAOA", "S81OAWT", "S81WTOA", "S81WTWT"))
pdf("subset_obj.umap_cluster01BySamples.pdf", width=6, height=6)
DimPlot(subset_obj, reduction = "umap", split.by = "sample", pt.size=0.5, ncol=4)
dev.off()
```
<img width="450" height="450" alt="subset_obj umap_cluster01BySamples" src="https://github.com/user-attachments/assets/c7d0808b-a714-453a-9b8d-252857399f06" />

```R
# Use FindAllMarkers to find markers for all clusters
markers <- FindAllMarkers(subset_obj, 
                          only.pos = TRUE,   # Only return markers that are positively expressed
                          min.pct = 0.25,    # Minimum percentage of cells expressing the gene
                          logfc.threshold = 0.25)  # Minimum log fold change to consider a gene as a marker

# View the top markers for each cluster
head(markers)
write.table(markers, "subset_obj.markers.txt", row.names=F, col.names=TRUE, sep="\t", quote=F)

DefaultAssay(subset_obj) <- "integrated"
# Select the top 10 genes per cluster based on average log fold change
top20 <- markers %>%
  group_by(cluster) %>%
  top_n(n = 20, wt = avg_log2FC)

pdf("subset_obj.heatmap.pdf")
# Generate the heatmap
DoHeatmap(subset_obj, features = top20$gene, group.by = "seurat_clusters") +
  scale_fill_gradientn(colors = c("blue", "white", "red")) +
  theme(
    axis.text.y = element_blank(), # Remove y-axis text
    axis.text.x = element_blank(), # Remove x-axis text
    axis.title.y = element_blank(), # Remove y-axis label
    axis.title.x = element_blank()  # Remove x-axis label
  )
dev.off()
```
<img width="500" height="500" alt="subset_obj heatmap" src="https://github.com/user-attachments/assets/7fa0053b-0bf1-47fb-96fb-525f1405e692" />

```R
# Shell gland and hemocyte
DefaultAssay(subset_obj) <- "RNA"
subset_obj <- subset(subset_obj, idents = c(1, 2, 3, 4, 5, 6, 7, 8, 9))
cell_marker <- read.table(file = "./CellMarker.ShellGland_Hemocyte_Prol.csv", sep = "\t", header = T)
cell_marker
pdf("subset_obj.umap_cluster01.pdf", width=16, height=7)
library(colorspace)
library(ggsci)
my_colors <- qualitative_hcl(21, palette = "Dark 2")
p1 <- DimPlot(subset_obj, reduction = "umap", group.by = "seurat_clusters", label = T) + scale_color_manual(values = my_colors) + scale_color_npg()
p2 <- DotPlot(subset_obj, features = unique(cell_marker$Cell_Marker), col.min = 0) +
    theme(axis.text = element_text(size = 12, angle = 90, hjust = 1)) +
    scale_color_gradient(low = "grey", high = "#002366") +
    scale_x_discrete(labels = c(
    "LOC105333436"="g33436_CBX1",
	"LOC105337940"="g37940_MGN2",
	"LOC105339039"="g39039_SUMO3",
	"LOC105341104"="g41104_PCNA",
	"LOC105329085"="g29085_Hmgb3",
	"LOC105320932"="g20932_Smarca5",
	"LOC105326721"="g26721_Mantle",
	"LOC105344040"="g44040_Tyr2",
	"LOC105318603"="g18603_Fndc2",
	"LOC105320011"="g20011_Tyr1",
	"LOC105340517"="g40517_Sox8",
	"LOC105333626"="g33626_Muc2",
	"LOC105318132"="g18132_Hnrnpa1",
	"LOC105325734"="g25734_CS2",
	"LOC105318670"="g18670_Shematrin",
	"LOC105345004"="g45004_Cnfn-a",
	"LOC105339709"="g39709_FLO11",
	"LOC105331572"="g31572_Chia",
	"LOC105344097"="g44097_Col7a1",
	"LOC105324613"="g24613_CS2",
	"LOC105318856"="g18856_En1-b",
	"LOC105318858"="g18858_En1-b",
	"LOC105345135"="g45135_7B2",
	"LOC117680451"="g80451_Syt1",
	"LOC105322251"="g22251_Cac1a-1",
	"LOC105321391"="g22251_Snap-25",
	"LOC105346371"="g46371_Cygb1",
	"LOC105324772"="g24772_Mmg2",
	"LOC105331021"="g31021_Galr1",
	"LOC105340129"="g40129_Allatotropins",
	"LOC105342307"="g42307_Oka",
	"LOC105329814"="g29814_Sstr2",
	"LOC105343071"="g43071_Tub2",
	"LOC105320177"="g20177_Tekt1",
	"LOC105325415"="g25415_Tekt2",
	"LOC105320035"="g20035_Tekt4",
	"LOC105325532"="g25532_CAV1",
	"LOC105334327"="g34327_CAV1",
	"LOC105339683"="g39683_CAV1",
	"LOC105331920"="g31920_CROCC",
	"LOC105338883"="g38883_Rsph4a",
	"LOC105335489"="g35489_Tpm",
	"LOC105348570"="g48570_Tnnt",
	"LOC105332629"="g32629_Twitchin",
	"LOC105329786"="g29786_Mhc",
	"LOC105344358"="g44358_Cnn2",
	"LOC105329481"="g29481_Tnnc2",
	"LOC105329634"="g29634_Pmy",
	"LOC105329196"="g29196_Col4a1",
	"LOC105322305"="g22305_Lamc1",
	"LOC105335256"="g35256_Lama1",
	"LOC105344313"="g44313_Mmp2",
	"LOC105348091"="g348091_Fermt2",
	"LOC105328023"="g28023_Ndg",
	"LOC105329712"="g29712_Ivl",
	"LOC105328534"="g28534_Tktl2",
	"LOC105325966"="g25966_Cdc42")) +
	scale_y_discrete(limits = c("3","6","9","4","8","1","7","2","5"))
p1 + p2 + plot_layout(nrow = 1, width = c(1, 2))
dev.off()
```
<img width="1200" height="525" alt="subset_obj umap_cluster01" src="https://github.com/user-attachments/assets/84e8e661-6e3b-4f12-8fc0-dee61772b139" />

## 2025-08-08（周五）
- 记录 acidification 实验 pH 波动
- 初步查看 survival 结果

...（持续追加每天）
